{% extends "base.html" %} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Admin Dashboard</h2>
  <a href="{% url 'admin_create_event' %}" class="btn btn-primary"
    >Create Event</a
  >
</div>

<h4>Events</h4>
<ul class="list-group mb-4">
  {% for e in events %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span><strong>{{ e.title }}</strong> â€” {{ e.date_time|date:"M d, Y H:i" }}</span>
      <span>
        <span class="badge bg-secondary">Seats: {{ e.total_seats }} | Remaining: {{ e.remaining_seats }}</span>
        <span class="badge bg-success">Approved: {{ e.approved_count }}</span>
      </span>
    </li>
  {% empty %}
    <li class="list-group-item">No events yet.</li>
  {% endfor %}
</ul>

<h4 class="mt-4">Approved Registrations</h4>
<table class="table table-striped">
  <thead>
    <tr>
      <th>User</th>
      <th>Name</th>
      <th>Student ID</th>
      <th>Phone</th>
      <th>Event</th>
      <th>Tickets</th>
      <th>Payment</th>
      <th>Transaction</th>
      <th>Approved At</th>
    </tr>
  </thead>
  <tbody>
    {% for r in approved_regs %}
      <tr>
        <td>{{ r.user.username }}</td>
        <td>{{ r.name }}</td>
        <td>{{ r.student_id }}</td>
        <td>{{ r.phone_number }}</td>
        <td>{{ r.event.title }}</td>
        <td>{{ r.tickets_booked }}</td>
        <td>{{ r.payment_method }}</td>
        <td>{{ r.transaction_id }}</td>
        <td>{{ r.registered_at|date:"M d, Y H:i" }}</td>
      </tr>
    {% empty %}
      <tr><td colspan="9">No approved registrations yet.</td></tr>
    {% endfor %}
  </tbody>
</table>


<h4 class="mt-4">Pending Registrations</h4>
<table class="table table-striped">
  <thead>
    <tr>
      <th>User</th>
      <th>Name</th>
      <th>Student ID</th>
      <th>Phone</th>
      <th>Event</th>
      <th>Tickets</th>
      <th>Payment</th>
      <th>Transaction</th>
      <th>Submitted</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for r in pending_regs %}
      <tr>
        <td>{{ r.user.username }}</td>
        <td>{{ r.name }}</td>
        <td>{{ r.student_id }}</td>
        <td>{{ r.phone_number }}</td>
        <td>{{ r.event.title }}</td>
        <td>{{ r.tickets_booked }}</td>
        <td>{{ r.payment_method }}</td>
        <td>{{ r.transaction_id }}</td>
        <td>{{ r.registered_at|date:"M d, Y H:i" }}</td>
        <td>
          <form method="post" action="{% url 'admin_approve_registration' r.id %}" style="display:inline;">
            {% csrf_token %}
            <button class="btn btn-success btn-sm">Approve</button>
          </form>
          <form method="post" action="{% url 'admin_reject_registration' r.id %}" style="display:inline;">
            {% csrf_token %}
            <button class="btn btn-danger btn-sm">Reject</button>
          </form>
        </td>
      </tr>
    {% empty %}
      <tr><td colspan="10">No pending registrations.</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
